name: Monitor Latencia (Docker Version)

on:
  schedule:
    # Ejecutar cada 6 horas (puedes cambiarlo)
    - cron: "0 */6 * * *"
  workflow_dispatch: # Bot贸n para ejecutar manual desde la web

# Damos permiso al bot para escribir en el repositorio
permissions:
  contents: write

jobs:
  run-docker-bot:
    runs-on: ubuntu-latest

    steps:
      # 1. Descargar tu c贸digo del repositorio
      - name: Checkout del c贸digo
        uses: actions/checkout@v3

      # 2. Construir la imagen Docker (igual que hiciste en tu PC)
      - name: Construir Imagen Docker
        run: docker build -t latency-bot .

      # 3. Ejecutar el contenedor
      # El truco aqu铆 es "-v ${{ github.workspace }}:/app"
      # Esto conecta la carpeta del servidor de GitHub con la carpeta /app del contenedor
      # As铆, cuando el script guarde la imagen, aparecer谩 fuera del contenedor.
      # ... (Pasos anteriores igual) ...

      - name: Ejecutar Monitor de Latencia
        run: |
          # Esto generar谩 'latency_map.png' Y 'commit_strategy.sh'
          docker run --rm -v ${{ github.workspace }}:/app latency-bot

      - name: Ejecutar Estrategia de Commits Din谩mica
        run: |
          # Damos permisos de ejecuci贸n al script generado por Python
          chmod +x commit_strategy.sh

          # Ejecutamos el script que contiene los git add/commit/push
          ./commit_strategy.sh

      # 4. Detectar cambios y hacer Commit
      - name: Guardar cambios (Commit & Push)
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

          # Verificamos si la imagen cambi贸
          git add latency_map.png

          # Hacemos commit solo si hay cambios, si no, no falla
          git commit -m " Update: Latency Map [Automated]" || echo "No changes to commit"

          git push
